<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dutch Course | Learn Dutch For Beginners</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/0391e00170.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="sidebar">
        <nav>
            <a class="navbar-brand" href="#">Verbocity</a>
            <ul>
                <li>
                    <i class="fa-solid fa-check cbutton" style="padding-right: 15px; font-size: large; color: green;"></i>
                    <a href="Module1.html" style="color: black; text-decoration: none;">
                        Module 01<br>
                        <small>Learn Dutch For Beginners</small>
                    </a>
                </li>
                <li>
                    <i class="fa-solid fa-check cbutton current-module" style="padding-right: 15px; font-size: large; color: green;"></i>
                    <a href="Module2.html" style="color: black; text-decoration: none;">
                        Module 02<br>
                        <small>Dutch Greetings</small>
                    </a>
                </li>
                <li class="active">
                    <i class="fa-solid fa-play cbutton" style="padding-right: 15px; font-size: large;"></i>
                    <a href="Module3.html" style="color: black; text-decoration: none;">
                        Module 03<br>
                        <small>Introducing yourself in Dutch</small>
                    </a>
                </li>
                <li>
                    <i class="fa-solid fa-play cbutton" style="padding-right: 15px; font-size: large;"></i>
                    <a href="Module4.html" style="color: black; text-decoration: none;">
                        Module 04<br>
                        <small>Where are you from and where do you live</small>
                    </a>
                </li>
                <li>
                    <i class="fa-solid fa-play cbutton" style="padding-right: 15px; font-size: large;"></i>
                    <a href="Module5.html" style="color: black; text-decoration: none;">
                        Module 05<br>
                        <small>Dutch Sounds and the Alphabets</small>
                    </a>
                </li>
                <li>
                    <i class="fa-solid fa-play cbutton" style="padding-right: 15px; font-size: large;"></i>
                    <a href="Module6.html" style="color: black; text-decoration: none;">
                        Module 06<br>
                        <small style="padding-left: 28px;">Dutch Quiz</small>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <div class="main-content">
        <div class="d-flex justify-content-between align-items-center courseName">
            <h4>Dutch Course</h4>

            <!-- Progress Circle -->
            <div class="circle crimson">
                <div id="circle_inner" style="color: white;">95%</div>
            </div>
        </div>

        <!-- Video Section -->
        <div class="video-container" style="justify-content: right;">
            <iframe id="ytplayer" width="100%" height="500" src="https://www.youtube.com/embed/Dbv79prOMEk?enablejsapi=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>

        <!-- Buttons Section -->
        <div class="buttons">
            <button style="background-color: #ff6d3a; border-radius: 5px; padding: 10px 25px;" class="cheatbtn">
                <a style="text-decoration: none; color: white;" href="../../cheatsheets/dutch/index.html">View Cheatsheets</a>
            </button>
        </div>
    </div>

    <!-- Load YouTube IFrame API -->
    <script>
        let player;
        let videoWatched = false;
        const currentModule = 'module3'; // Unique identifier for this module
    
        function loadModuleCompletionStatus() {
            const isCompleted = localStorage.getItem(currentModule) === 'completed';
            console.log('Is Module Completed?', isCompleted); // Debug statement to check status
            if (isCompleted) {
                updateCurrentModuleToTick();
            }
        }
    
        // YouTube API Setup
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('ytplayer', {
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });
        }
    
        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING && !videoWatched) {
                const videoDuration = player.getDuration();
                const interval = setInterval(function () {
                    const currentTime = player.getCurrentTime();
                    const percentageWatched = (currentTime / videoDuration) * 100;
                    console.log(`Watched: ${percentageWatched}%`); // Debug statement to check progress
    
                    if (percentageWatched >= 80 && !videoWatched) {
                        videoWatched = true;
                        clearInterval(interval);
                        updateCurrentModuleToTick();
                        localStorage.setItem(currentModule, 'completed');
                    }
                }, 1000); // Check every second
            }
        }
    
        function updateCurrentModuleToTick() {
            const currentModuleItem = document.querySelector("li.active .cbutton"); // Select the icon inside the active list item
            if (currentModuleItem) {
                currentModuleItem.classList.remove("fa-play");
                currentModuleItem.classList.add("fa-check", "text-success");
            }
        }
    
        document.addEventListener("DOMContentLoaded", function () {
            loadModuleCompletionStatus();
        });
    
        // Corrected percentage calculation for each module
        let totalModules = 6;
        let circleInner = document.getElementById("circle_inner");
    
        // Map the currentModule to the correct percentage dynamically
        const moduleProgress = {
            'module1': 1,
            'module2': 2,
            'module3': 3,
            'module4': 4,
            'module5': 5,
            'module6': 6
        };
    
        if (currentModule in moduleProgress) {
            let progressPercentage = Math.floor(((moduleProgress[currentModule]-1) / totalModules) * 100);
            circleInner.innerText = `${progressPercentage}%`;
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
